# Реализация REST API с тремя HTTP-методами для Backend-разработки. #

:gb: [English version here](README.md)

![Python](https://img.shields.io/badge/python-3670A0?style=plastic&logo=python&logoColor=ffdd54)
![SQLite](https://img.shields.io/badge/sqlite-%2307405e.svg?style=plastic&logo=sqlite&logoColor=white)
**`Bottle`**

----

## Содержание ##

[1. Условия задания](#условия-задания)    
[2. Описание решения](#описание-решения)    
[3. Результат](#результат)    
[4. Инструкция по запуску проекта](#инструкция-по-запуску-проекта)    

## Условия задания ##

Реализовать REST API с тремя http-методами:

1. **`POST /v1/auth/register`**    
    Принимает json:

    ```text
    {
        "phone": "+79167003020",
        "login": "rubella19",
        "password": "1Qwerty!",
        "name": "Анастасия",
        "birth": "2000-07-28",
        "tg": "@Rubella19",
        "email": "anastasia.a.krasnova@gmail.com"
    }
    ```

    При этом **`phone`**, **`name`**, **`birth`**, **`login`**,
    **`password`**&nbsp;&mdash; обязательные, **`tg`**, **`email`**&nbsp;&mdash;
    необязательные поля.

    Требуется реализовать проверки валидности данных.

    В сервисе не должны быть зарегистрированы несовершеннолетние.

    Возвращает **json** с идентификатором пользователя в случае успеха, в случае
    ошибки возвращает **json** с двумя полями **`Код`** и **`Текст`**.

2. **`POST /v1/auth/login`**    
    Принимает **json** с логином паролем и возвращает **json** с идентификатором
    пользователя в случае успеха, в случае ошибки возвращает **json** с двумя
    полями **`Код`** и **`Текст`**.

3. **`GET /v1/user`**    
    С query-параметром **`id`**, возвращает **json** со всеми полями
    пользователя (кроме пароля) или **`Код-Текст`** ошибки.

Все данные сохранять в базе.

На выходе:

- репозиторий с кодом;
- SQL script для создания схемы БД (должен лежать в репозитории);
- конфиг приложения, где можно указать конфиг БД;
- подписать в **README** какую базу данных использовали;
- написать в **README** как запустить проект.

**Advanced**: добавить скрипты для запуска API. Например, добавить `Makefile` с
таргетом `run`, который должен запустить сделанный API на порту 8080.

[:arrow_up: Содержание](#содержание)

----

## Описание решения ##

- Для запуска и демонстрации работы API принято решение использовать простой
web-сервер **Bottle** и СУБД **SQLite3** вместо **Django** и **PostgreSQL**,
чтобы уложиться в сроки.

- При проверке на совершеннолетие для простоты предполагается, что дата рождения
уже прошла предварительное форматирование и поле `birth` содержит строку с
числами в формате `YYYY-MM-DD`.

- База данных **SQLite3** содержит две таблицы. В таблице **`Users`** хранятся
все пользовательские данные. В таблице **`Errors`** создан минимальный набор
вариантов ошибок, который можно расширить под будущие требования.

- Первый метод API при регистрации пользователя не проводит проверку на
уникальность (если такой пользователь уже есть в БД), поскольку ещё надо
определить чёткие критерии уникальности.

- Третий метод API возвращает **json** со всеми полями кроме `uid` и `password`.
Если в БД у пользователя в необязательных колонках `email` и/или `tg` стоит
`NULL`, то соответствующие поля **json** на выходе содержат `null`. При желании
можно исключить вывод таких полей.

[:arrow_up: Содержание](#содержание)

----

## Результат ##

[**`api_module.py`**](api_module.py)&nbsp;&mdash; основной модуль, содержащий
все три метода API.

[**`api_validations.py`**](api_validations.py)&nbsp;&mdash; дополнительный
модуль для проверки входящих данных. Содержит функциональные заготовки
валидации входных данных, которые можно &laquo;накрутить&raquo; при появлении
дополнительных требований.

[**`api_demo.py`**](api_demo.py)&nbsp;&mdash; скрипт для запуска и демонстрации
API на порту 8080 в виртуальном окружении.

[**`sqlite/db.sql`**](sqlite/db.sql)&nbsp;&mdash; SQL-скрипт для создания файла
базы данных **`sqlite/db.sqlite3`**.

[:arrow_up: Содержание](#содержание)

----

## Инструкция по запуску проекта ##

1. На компьютере должен быть установлен **Python** версии **3.8** или более
поздней и соответствующий пакетный менеджер **pip**.
2. Установить **SQLite3** (можно по руководствам
[для Linux](https://linoxide.com/install-use-sqlite-linux) или
[для Windows](https://www.sqlitetutorial.net/download-install-sqlite/)).
3. Скачать файлы проекта из текущей директории репозитория в локальную
директорию компьютера.
4. Для создания файла БД `sqlite/db.sqlite3` войти в поддиректорию `sqlite`,
запустить **SQLite** и потом ввести мета-команды:

    ```bash
    # Запуск
    sqlite3 db.sqlite3

    # Мета-команды
    .read db.sql
    .exit
    ```

5. Примерная последовательность команд в консоли терминала для запуска проекта
в виртуальном окружении `virtualenv` в локальной директории:

    ```bash
    python -m venv VENV

    # для ОС Linux:
    source VENV/bin/activate
    # для ОС Windows:
    VENV\Scripts\activate

    pip install -r requirements.txt

    python api_demo.py
    # Выход по Ctrl+C

    # Выход из виртуального окружения
    # для ОС Linux:
    deactivate
    # для ОС Windows:
    VENV\Scripts\deactivate.bat
    ```

6. Для проверки можно использовать пакет [**`HTTPie`**](https://httpie.io/).
Если его нет в ОС, можно дополнительно установить в отдельной консоли с текущим
виртуальным окружением:

    ```bash
    pip install httpie
    ```

    и сделать запросы для проверки первого метода:

    ```bash
    http POST http://127.0.0.1:8080/v1/auth/register phone="+79167003020" login="rubella19" password="1Qwerty!" name="Анастасия" birth="2000-07-28" tg="\@Rubella19" email="anastasia.a.krasnova@gmail.com"
    ```

    для проверки второго метода:

    ```bash
    http POST http://127.0.0.1:8080/v1/auth/login login="rubella19" password="1Qwerty!"
    ```

    для проверки третьего метода:

    ```bash
    http GET http://127.0.0.1:8080/v1/user?id=00000000-2222-2222-2222-000000000000
    ```

[:arrow_up: Содержание](#содержание)

----
